<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>TOEIC Island</title>
  <style>
    body {
      margin: 0;
      font-family: "Microsoft JhengHei", sans-serif;
      background: #f2f7fb;
      color: #333;
      overflow-x: hidden;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      padding: 10px 20px;
      flex-wrap: wrap;
    }
    .player-info {
      display: flex;
      align-items: center;
      gap: 10px;
      flex: 1;
      flex-wrap: wrap;
    }
    .player-info img.avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid #ddd;
      cursor: pointer;
    }
    .player-name {
      font-weight: bold;
      font-size: 18px;
    }
    .rename-icon {
      width: 22px;
      height: 22px;
      cursor: pointer;
      vertical-align: middle;
    }
    .level-container {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .level {
      font-size: 14px;
    }
    .level-bar {
      width: 100px;
      height: 8px;
      background: #ddd;
      border-radius: 5px;
      overflow: hidden;
      margin-left: 5px;
      display: inline-block;
      vertical-align: middle;
    }
    .level-bar-fill {
      height: 100%;
      width: 0%; 
      background: #4caf50;
      transition: width 0.3s;
    }
    .help-btn {
      width: 32px;
      height: 32px;
      border: none;
      border-radius: 50%;
      background: #fff;
      cursor: pointer;
      font-weight: bold;
      font-size: 18px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      transition: transform 0.2s;
    }
    .help-btn:hover {
      background: #f8f8f8;
      transform: scale(1.1);
    }

    /* 資源列 */
    .resources {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }
    .resource {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 16px;
    }
    .resource img {
      width: 24px;
      height: 24px;
    }

    main {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 10px;
    }
    .island-container {
      position: relative;
      max-width: 1024px;
      border-radius: 20px;
      overflow: hidden;
    }
    .island-container img {
      width: 100%;
      height: auto;
      display: block;
    }

    /* 城區矩陣 */
    .city-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 15px; /* 增加按鈕間距 */
      margin-top: 25px; /* 增加與島圖的間距 */
      max-width: 1024px;
      width: 100%;
      padding: 0 10px; /* 左右內邊距，避免貼邊 */
    }
    
    /* 新的城區按鈕樣式 */
    .city-button {
      display: flex;
      flex-direction: column; /* 讓文字和等級垂直排列 */
      justify-content: center;
      align-items: center;
      height: 90px; /* 固定按鈕高度 */
      background: linear-gradient(135deg, #a8dadc, #457b9d); /* 漸變背景 */
      color: white;
      text-decoration: none;
      border-radius: 12px;
      font-weight: bold;
      font-size: 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      transition: transform 0.2s, background 0.2s, box-shadow 0.2s;
      cursor: pointer;
      border: none; /* 移除預設按鈕邊框 */
      padding: 5px; /* 內部填充 */
      text-align: center; /* 文字置中 */
      white-space: normal; /* 允許文字換行 */
      overflow: hidden; /* 隱藏超出部分 */
    }
    .city-button:hover {
      transform: translateY(-3px) scale(1.02);
      background: linear-gradient(135deg, #FFD700, #FFA07A); /* 🔥 懸停時變為柔和暖色 */
      box-shadow: 0 6px 12px rgba(0,0,0,0.3);
    }
    .city-button span.city-name {
        font-size: 1.2em; /* 城區名稱稍大 */
        line-height: 1.2;
    }
    .city-button span.city-level {
        font-size: 0.9em; /* 等級文字稍小 */
        margin-top: 3px;
        opacity: 0.9;
    }


    footer {
      text-align: center;
      font-size: 12px;
      color: #777;
      padding: 20px 10px; /* 增加上下間距 */
    }

    /* 測試按鈕容器 */
    .action-buttons {
      display: flex;
      justify-content: center;
      gap: 15px; /* 按鈕間距 */
      margin: 10px auto 20px;
      flex-wrap: wrap; /* 響應式換行 */
    }

    /* 測試和重置按鈕樣式 */
    .action-buttons .btn {
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s, transform 0.2s;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      min-width: 120px; /* 最小寬度 */
    }
    .action-buttons .btn-test {
      background: #4caf50;
      color: white;
    }
    .action-buttons .btn-test:hover {
      background: #45a049;
      transform: translateY(-2px);
    }
    .action-buttons .btn-reset {
      background: #f44336;
      color: white;
    }
    .action-buttons .btn-reset:hover {
      background: #d32f2f;
      transform: translateY(-2px);
    }


    /* 響應式：手機時縮小字體，改成四欄 */
    @media (max-width: 768px) {
      .city-grid {
        grid-template-columns: repeat(4, 1fr); /* 🔥 改成四欄 */
        gap: 8px; /* 調整手機板間距 */
      }
      .city-button {
        height: 70px; /* 手機版按鈕高度 */
        font-size: 14px; /* 手機版字體縮小 */
      }
      .city-button span.city-name {
        font-size: 0.9em;
      }
      .city-button span.city-level {
        font-size: 0.75em;
      }
      .action-buttons .btn {
        padding: 8px 15px;
        font-size: 14px;
        min-width: 100px;
      }
    }

    /* 說明視窗 */
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      justify-content: center;
      align-items: center;
      z-index: 1000; /* 確保在最上層 */
    }
    .modal-content {
      background: #fff;
      padding: 25px; /* 增加內邊距 */
      border-radius: 12px;
      max-width: 500px;
      text-align: left;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      position: relative; /* 為了關閉按鈕定位 */
    }
    .modal-close {
      position: absolute; /* 絕對定位關閉按鈕 */
      top: 10px;
      right: 15px;
      cursor: pointer;
      font-weight: bold;
      font-size: 24px; /* 關閉按鈕字體大一點 */
      color: #777;
    }
    .modal-close:hover {
        color: #333;
    }
  </style>
</head>
<body>
  <header>
    <!-- 左側玩家資訊 -->
    <div class="player-info">
      <input type="file" id="avatarUpload" accept="image/*" style="display:none">
      <img src="img/avatar.png" alt="avatar" class="avatar" id="avatarImg">
      <span class="player-name" id="playerName">島主</span>
      <img src="img/rename.png" class="rename-icon" alt="rename" id="renameBtn">
      <div class="level-container">
        <div class="level">LV: <span id="playerLevel">1</span>
          <div class="level-bar"><div class="level-bar-fill" id="levelBar"></div></div>
        </div>
        <button class="help-btn">?</button>
      </div>
    </div>

    <!-- 右側資源 -->
    <div class="resources">
      <div class="resource"><img src="img/item001.png"><span>0</span></div>
      <div class="resource"><img src="img/item002.png"><span>0</span></div>
      <div class="resource"><img src="img/item003.png"><span>0</span></div>
      <div class="resource"><img src="img/item004.png"><span>0</span></div>
      <div class="resource"><img src="img/item005.png"><span>0</span></div>
    </div>
  </header>

  <main>
    <div class="island-container">
      <img src="img/island_LV1.jpeg" alt="island" id="island-img">
    </div>

    <!-- 20 城區矩陣 (JS 生成) -->
    <div class="city-grid" id="cityGrid"></div>
  </main>

  <!-- 測試與重置按鈕區塊 -->
  <div class="action-buttons">
    <button class="btn btn-test" id="testLevelBtn">🔼 測試升級</button>
    <button class="btn btn-reset" id="resetProgressBtn">🔄 重置進度</button>
  </div>

  <footer>
    Copyright © 2025 Comibast All Rights Reserved
  </footer>

  <!-- 說明視窗 -->
  <div class="modal" id="helpModal">
    <div class="modal-content">
      <span class="modal-close" id="closeModal">&times;</span>
      <h3>玩法說明</h3>
      <p>
        TOEIC單字依照類別分成20區，點選城區進行拼字遊戲。<br>
        每次5個單字，答對一字20分，滿分100分。<br>
        可以使用提示下一個字母的功能，每用一次扣一分。<br>
        分數會轉化成經驗值，提升城區等級。<br>
        玩家等級為全島城區等級的平均值（四捨五入）。<br>
        每升10級，主島的模樣會進化，從簡單可愛，變得華麗精緻！
      </p>
    </div>
  </div>

  <script>
    // 城區名稱
    const cities = [
      "住宿交通", "餐飲觀光", "行銷銷售", "調查研究", "社會財經",
      "部門組織", "招募薪資", "績效訓練", "購物訂單", "售後服務",
      "經營管理", "生產製造", "辦公溝通", "行政會議", "設備研發",
      "金融財務", "房屋修繕", "傳媒出版", "藝文活動", "健康生活"
    ];

    // 預設值
    let playerLevel = 1;
    let playerExp = 0; // 玩家經驗值，用於顯示進度條
    let cityLevels = new Array(20).fill(1);
    let playerName = "島主"; // 新增玩家名稱狀態

    // 嘗試從 localStorage 載入資料
    function loadData() {
      const data = localStorage.getItem("toeicIslandSave");
      if (data) {
        const save = JSON.parse(data);
        playerLevel = save.playerLevel || 1;
        playerExp = save.playerExp || 0;
        cityLevels = save.cityLevels || new Array(20).fill(1);
        playerName = save.playerName || "島主"; // 載入玩家名稱
      }
    }

    // 儲存資料到 localStorage
    function saveData() {
      const save = {
        playerLevel,
        playerExp,
        cityLevels,
        playerName // 儲存玩家名稱
      };
      localStorage.setItem("toeicIslandSave", JSON.stringify(save));
    }

    // 產生城區矩陣 (更新為按鈕樣式)
    function renderCities() {
      const grid = document.getElementById("cityGrid");
      grid.innerHTML = "";
      cities.forEach((name, i) => {
        const level = cityLevels[i];
        const filename = (i+1).toString().padStart(2,"0") + name + ".html";
        
        const button = document.createElement("a"); // 使用a標籤模擬按鈕，方便跳轉
        button.href = filename;
        button.className = "city-button";
        button.innerHTML = `
          <span class="city-name">${name}</span>
          <span class="city-level">LV${level}</span>
        `;
        grid.appendChild(button);
      });
    }

    // 玩家 UI 更新
    const playerLevelEl = document.getElementById('playerLevel');
    const levelBar = document.getElementById('levelBar');
    const islandImg = document.getElementById('island-img');
    const playerNameEl = document.getElementById('playerName'); // 獲取玩家名稱元素

    function updateIsland(level) {
      if (level >= 30) islandImg.src = "img/island_LV30.jpeg";
      else if (level >= 20) islandImg.src = "img/island_LV20.jpeg";
      else if (level >= 10) islandImg.src = "img/island_LV10.jpeg";
      else islandImg.src = "img/island_LV1.jpeg";
    }

    function updateUI() {
      playerNameEl.textContent = playerName; // 更新玩家名稱
      playerLevelEl.textContent = playerLevel;
      levelBar.style.width = (playerExp % 100) + "%"; // 假設每100點經驗升級
      updateIsland(playerLevel);
      renderCities();
      saveData(); // 更新後立即存檔
    }

    // 測試升級按鈕
    const testBtn = document.getElementById('testLevelBtn');
    testBtn.addEventListener('click', () => {
      // 模擬升級邏輯：增加經驗值，每100點經驗升一級
      playerExp += 50; // 每次點擊增加50經驗
      if (playerExp >= playerLevel * 100) { // 假設每級所需經驗為 playerLevel * 100
        playerLevel++;
        playerExp = playerExp % 100; // 重置經驗條
      }

      if (playerLevel > 30) playerLevel = 30; // 最高30級
      
      // 20 城區同步升級 (簡化邏輯，實際應根據遊戲分數計算)
      cityLevels = cityLevels.map(lv => Math.min(lv + 1, 30)); // 每個城區也同步升級，最高30級
      updateUI();
    });

    // 重置進度按鈕
    const resetProgressBtn = document.getElementById('resetProgressBtn');
    resetProgressBtn.addEventListener('click', () => {
      if (confirm("確定要重置所有遊戲進度嗎？這將無法復原！")) {
        localStorage.removeItem("toeicIslandSave");
        location.reload(); // 重載頁面以回到初始狀態
      }
    });

    // 改名功能
    const renameBtn = document.getElementById('renameBtn');
    renameBtn.addEventListener('click', () => {
      const newName = prompt("請輸入新名稱：", playerName); // 使用 playerName 變數
      if (newName && newName.trim() !== "") {
        playerName = newName.trim(); // 更新玩家名稱變數
        updateUI(); // 更新UI並存檔
      }
    });

    // 上傳頭像功能
    const avatarImg = document.getElementById('avatarImg');
    const avatarUpload = document.getElementById('avatarUpload');
    avatarImg.addEventListener('click', () => {
      avatarUpload.click();
    });
    avatarUpload.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(event) {
          avatarImg.src = event.target.result;
        };
        reader.readAsDataURL(file);
      }
    });

    // 說明視窗
    const helpBtn = document.querySelector('.help-btn');
    const helpModal = document.getElementById('helpModal');
    const closeModal = document.getElementById('closeModal');
    helpBtn.addEventListener('click', () => {
      helpModal.style.display = 'flex';
    });
    closeModal.addEventListener('click', () => {
      helpModal.style.display = 'none';
    });
    window.addEventListener('click', (e) => {
      if (e.target === helpModal) {
        helpModal.style.display = 'none';
      }
    });

    // 初始化
    loadData();
    updateUI();
  </script>
</body>
</html>