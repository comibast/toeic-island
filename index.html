<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>TOEIC Island</title>
  <style>
    body {
      margin: 0;
      font-family: "Microsoft JhengHei", sans-serif;
      background: #f2f7fb;
      color: #333;
      overflow-x: hidden;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      padding: 10px 20px;
      flex-wrap: wrap;
    }
    .player-info {
      display: flex;
      align-items: center;
      gap: 10px;
      flex: 1;
      flex-wrap: wrap;
    }
    .player-info img.avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid #ddd;
      cursor: pointer;
    }
    .player-name {
      font-weight: bold;
      font-size: 18px;
    }
    .rename-icon {
      width: 22px;
      height: 22px;
      cursor: pointer;
      vertical-align: middle;
    }
    .level-container {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .level {
      font-size: 14px;
    }
    .level-bar {
      width: 100px;
      height: 8px;
      background: #ddd;
      border-radius: 5px;
      overflow: hidden;
      margin-left: 5px;
      display: inline-block;
      vertical-align: middle;
    }
    .level-bar-fill {
      height: 100%;
      width: 0%; 
      background: #4caf50;
      transition: width 0.3s;
    }
    .help-btn {
      width: 32px;
      height: 32px;
      border: none;
      border-radius: 50%;
      background: #fff;
      cursor: pointer;
      font-weight: bold;
      font-size: 18px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      transition: transform 0.2s;
    }
    .help-btn:hover {
      background: #f8f8f8;
      transform: scale(1.1);
    }

    /* è³‡æºåˆ— */
    .resources {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }
    .resource {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 16px;
    }
    .resource img {
      width: 24px;
      height: 24px;
    }

    main {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 10px;
    }

    /* é›»è…¦ç‰ˆï¼šå·¦å³åˆ†æ¬„å¸ƒå±€ */
    .game-content {
      display: flex;
      gap: 30px;
      max-width: 1200px;
      width: 100%;
      align-items: flex-start;
    }

    /* å·¦å´å³¶å¶¼åœ–ç‰‡å®¹å™¨ */
    .island-container {
      position: relative;
      flex: 1;
      max-width: 500px; /* é™åˆ¶æœ€å¤§å¯¬åº¦ï¼Œé¿å…éå¤§ */
      border-radius: 20px;
      overflow: hidden;
      display: flex; /* ä½¿ç”¨ flexbox è®“åœ–ç‰‡å±…ä¸­ */
      justify-content: center; /* æ°´å¹³å±…ä¸­ */
      align-items: center; /* å‚ç›´å±…ä¸­ */
      background-color: #FFFFFF; /* å¦‚æœåœ–ç‰‡éæ–¹å½¢ï¼ŒèƒŒæ™¯è‰²å¯å¡«è£œç©ºç™½ */
    }
    .island-container img {
      width: auto; /* å¯¬åº¦è‡ªå‹• */
      height: auto; /* é«˜åº¦è‡ªå‹• */
      max-width: 100%; /* åœ–ç‰‡æœ€å¤§å¯¬åº¦ä¸è¶…éå®¹å™¨ */
      max-height: 100%; /* åœ–ç‰‡æœ€å¤§é«˜åº¦ä¸è¶…éå®¹å™¨ */
      display: block; /* ç§»é™¤åœ–ç‰‡åº•éƒ¨çš„ç©ºç™½ */
      object-fit: contain; /* ç¢ºä¿åœ–ç‰‡å®Œæ•´é¡¯ç¤ºï¼Œä¸è£åˆ‡ */
      /* object-fit: cover; */ /* å…ˆå‰é€ æˆè£åˆ‡çš„æ¨£å¼ */
    }

    /* å³å´åŸå€çŸ©é™£ */
    .cities-section {
      width: 100%;
      max-width: 500px;  /* è·Ÿå³¶å¶¼åœ–åŒä¸€å€‹ max-width */
      margin: 0 auto;    /* è®“å®ƒç½®ä¸­ */
    }

    /* åŸå€çŸ©é™£ */
    .city-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr); /* å›ºå®š4æ¬„ */
      gap: 15px;
      width: 100%;       /* æ»¿ç‰ˆä½”æ“š cities-section */
      margin-bottom: 20px;
    }
    
    /* æ–°çš„åŸå€æŒ‰éˆ•æ¨£å¼ */
    .city-button {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 90px;
      background: linear-gradient(135deg, #a8dadc, #457b9d);
      color: white;
      text-decoration: none;
      border-radius: 12px;
      font-weight: bold;
      font-size: 16px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      transition: transform 0.2s, background 0.2s, box-shadow 0.2s;
      cursor: pointer;
      border: none;
      padding: 5px;
      text-align: center;
      white-space: normal;
      overflow: hidden;
    }
    .city-button:hover {
      transform: translateY(-3px) scale(1.02);
      background: linear-gradient(135deg, #FFD700, #FFA07A);
      box-shadow: 0 6px 12px rgba(0,0,0,0.3);
    }
    .city-button span.city-name {
      font-size: 1.1em;
      line-height: 1.2;
    }
    .city-button span.city-level {
      font-size: 0.85em;
      margin-top: 3px;
      opacity: 0.9;
    }

    /* æ¸¬è©¦æŒ‰éˆ•å®¹å™¨ */
    .action-buttons {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin: 20px auto;
      flex-wrap: wrap;
    }

    /* æ¸¬è©¦å’Œé‡ç½®æŒ‰éˆ•æ¨£å¼ */
    .action-buttons .btn {
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s, transform 0.2s;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      min-width: 120px;
    }
    .action-buttons .btn-test {
      background: #4caf50;
      color: white;
    }
    .action-buttons .btn-test:hover {
      background: #45a049;
      transform: translateY(-2px);
    }
    .action-buttons .btn-reset {
      background: #f44336;
      color: white;
    }
    .action-buttons .btn-reset:hover {
      background: #d32f2f;
      transform: translateY(-2px);
    }

    footer {
      text-align: center;
      font-size: 12px;
      color: #777;
      padding: 20px 10px;
    }

    /* éŸ¿æ‡‰å¼ï¼šæ‰‹æ©Ÿæ™‚èª¿æ•´ç‚ºç¸±å‘æ’åˆ—ï¼Œå­—é«”åŠ å¤§ */
    @media (max-width: 968px) {
      .game-content {
        flex-direction: column;
        gap: 20px;
      }
      
      .island-container {
        max-width: 100%;
        height: auto !important; /* æ‰‹æ©Ÿç‰ˆæ¢å¾©è‡ªå‹•é«˜åº¦ */
        aspect-ratio: 1 / 1; /* ä¿æŒæ­£æ–¹å½¢æ¯”ä¾‹ */
      }
      
      .cities-section {
        max-width: 100%;
      }
    }

    @media (max-width: 768px) {
      .city-grid {
        grid-template-columns: repeat(4, 1fr);
        gap: 10px;
      }
      .city-button {
        height: 80px;
        font-size: 16px;
      }
      .city-button span.city-name {
        font-size: 1.0em;
      }
      .city-button span.city-level {
        font-size: 0.85em;
      }
      .action-buttons .btn {
        padding: 10px 18px;
        font-size: 15px;
        min-width: 110px;
      }
    }

    @media (max-width: 480px) {
      .island-container {
        width: 100%;
        border-radius: 12px;
      }
      
      .cities-section {
        width: 100%;
      }
      
      .city-button {
        height: 75px;
        font-size: 15px;
      }
      .city-button span.city-name {
        font-size: 0.95em;
      }
      .city-button span.city-level {
        font-size: 0.8em;
      }
    }

    /* èªªæ˜è¦–çª— */
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    .modal-content {
      background: #fff;
      padding: 25px;
      border-radius: 12px;
      max-width: 500px;
      text-align: left;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      position: relative;
    }
    .modal-close {
      position: absolute;
      top: 10px;
      right: 15px;
      cursor: pointer;
      font-weight: bold;
      font-size: 24px;
      color: #777;
    }
    .modal-close:hover {
        color: #333;
    }
  </style>
</head>
<body>
  <header>
    <div class="player-info">
		<label for="avatarUpload">
		  <img src="img/avatar.png" alt="avatar" class="avatar" id="avatarImg">
		</label>
		<input type="file" id="avatarUpload" accept="image/*" style="display:none">
      <span class="player-name" id="playerName">å³¶ä¸»</span>
      <img src="img/rename.png" class="rename-icon" alt="rename" id="renameBtn">
      <div class="level-container">
        <div class="level">LV: <span id="playerLevel">1</span>
          <div class="level-bar"><div class="level-bar-fill" id="levelBar"></div></div>
        </div>
        <button class="help-btn">?</button>

      </div>
    </div>

    <div class="resources">
      <div class="resource"><img src="img/gems/gem_fire.png"><span>0</span></div>
      <div class="resource"><img src="img/gems/gem_water.png"><span>0</span></div>
      <div class="resource"><img src="img/gems/gem_earth.png"><span>0</span></div>
      <div class="resource"><img src="img/gems/gem_wind.png"><span>0</span></div>
    </div>
  </header>

  <main>
    <div class="game-content">
      <div class="island-container">
        <img src="img/island_LV01.jpeg" alt="island" id="island-img">
      </div>

      <div class="cities-section">
        <div class="city-grid" id="cityGrid"></div>
        
        <div class="action-buttons">
          <button class="btn btn-test" id="testLevelBtn">ğŸ“ˆ æ¸¬è©¦å‡ç´š</button>
          <button class="btn btn-reset" id="resetProgressBtn">ğŸ”„ é‡ç½®é€²åº¦</button>
        </div>
      </div>
    </div>
  </main>

  <footer>
    Copyright Â© 2025 Comibast All Rights Reserved
  </footer>

  <div class="modal" id="helpModal">
    <div class="modal-content">
      <span class="modal-close" id="closeModal">&times;</span>
      <h3>ç©æ³•èªªæ˜</h3>
      <p>
        Ë™TOEICå–®å­—ä¾ç…§é¡åˆ¥åˆ†æˆ20å€ï¼Œé»é¸åŸå€é€²è¡Œæ‹¼å­—éŠæˆ²ã€‚<br>
        Ë™æ¯æ¬¡4å€‹å–®å­—ï¼Œç­”å°ä¸€å­—25åˆ†ï¼Œæ»¿åˆ†100åˆ†ã€‚<br>
        Ë™å¯ä»¥ä½¿ç”¨æç¤ºä¸‹ä¸€å€‹å­—æ¯çš„åŠŸèƒ½ï¼Œæ¯ç”¨ä¸€æ¬¡æ‰£ä¸€åˆ†ã€‚<br>
        Ë™åˆ†æ•¸æœƒè½‰åŒ–æˆç¶“é©—å€¼ï¼Œæå‡åŸå€ç­‰ç´šã€‚<br>
        Ë™ç©å®¶ç­‰ç´šç‚ºå…¨å³¶åŸå€ç­‰ç´šçš„å¹³å‡å€¼ï¼ˆå››æ¨äº”å…¥ï¼‰ã€‚<br>
        Ë™æ¯å‡10ç´šï¼Œä¸»å³¶çš„æ¨¡æ¨£æœƒé€²åŒ–ï¼Œå¾ç°¡å–®å¯æ„›ï¼Œè®Šå¾—è¯éº—ç²¾ç·»ï¼
      </p>
    </div>
  </div>

  <script>
    // åŸå€åç¨±
    const cities = [
      "ä½å®¿äº¤é€š", "é¤é£²è§€å…‰", "è¡ŒéŠ·éŠ·å”®", "èª¿æŸ¥ç ”ç©¶", "ç¤¾æœƒè²¡ç¶“",
      "éƒ¨é–€çµ„ç¹”", "æ‹›å‹Ÿè–ªè³‡", "ç¸¾æ•ˆè¨“ç·´", "è³¼ç‰©è¨‚å–®", "å”®å¾Œæœå‹™",
      "ç¶“ç‡Ÿç®¡ç†", "ç”Ÿç”¢è£½é€ ", "è¾¦å…¬æºé€š", "è¡Œæ”¿æœƒè­°", "è¨­å‚™ç ”ç™¼",
      "é‡‘èè²¡å‹™", "æˆ¿å±‹ä¿®ç¹•", "å‚³åª’å‡ºç‰ˆ", "è—æ–‡æ´»å‹•", "å¥åº·ç”Ÿæ´»"
    ];

    // é è¨­å€¼
    let playerLevel = 1;
    let playerExp = 0; // ç©å®¶ç¶“é©—å€¼ï¼Œç”¨æ–¼é¡¯ç¤ºé€²åº¦æ¢
    let cityLevels = new Array(20).fill(1);
    let playerName = "å³¶ä¸»"; // æ–°å¢ç©å®¶åç¨±ç‹€æ…‹
    let playerAvatar = "img/avatar.png"; // é è¨­é ­åƒ

    // å˜—è©¦å¾ localStorage è¼‰å…¥è³‡æ–™
    function loadData() {
      const data = localStorage.getItem("toeicIslandSave");
      if (data) {
        const save = JSON.parse(data);
        playerLevel = save.playerLevel || 1;
        playerExp = save.playerExp || 0;
        cityLevels = save.cityLevels || new Array(20).fill(1);
        playerName = save.playerName || "å³¶ä¸»";
        playerAvatar = save.playerAvatar || "img/avatar.png"; // è¼‰å…¥é ­åƒ // è¼‰å…¥ç©å®¶åç¨±
      }
    }

    // å„²å­˜è³‡æ–™åˆ° localStorage
    function saveData() {
      const save = {
        playerLevel,
        playerExp,
        cityLevels,
        playerName,
        playerAvatar // å„²å­˜é ­åƒ
      };
      localStorage.setItem("toeicIslandSave", JSON.stringify(save));
    }

    // ç”¢ç”ŸåŸå€çŸ©é™£ (æ›´æ–°ç‚ºæŒ‰éˆ•æ¨£å¼)
    function renderCities() {
      const grid = document.getElementById("cityGrid");
      grid.innerHTML = "";
      cities.forEach((name, i) => {
        const level = cityLevels[i];
        const filename = (i+1).toString().padStart(2,"0") + name + ".html";
        
        const button = document.createElement("a"); // ä½¿ç”¨aæ¨™ç±¤æ¨¡æ“¬æŒ‰éˆ•ï¼Œæ–¹ä¾¿è·³è½‰
        button.href = filename;
        button.className = "city-button";
        button.innerHTML = `
          <span class="city-name">${name}</span>
          <span class="city-level">LV${level}</span>
        `;
        grid.appendChild(button);
      });
    }

    // ç©å®¶ UI æ›´æ–°
    const playerLevelEl = document.getElementById('playerLevel');
    const levelBar = document.getElementById('levelBar');
    const islandImg = document.getElementById('island-img');
    const playerNameEl = document.getElementById('playerName'); // ç²å–ç©å®¶åç¨±å…ƒç´ 
    const islandContainer = document.querySelector('.island-container');
    const citiesSection = document.querySelector('.cities-section');
    const cityGrid = document.getElementById('cityGrid');


    function updateIsland(level) {
      if (level >= 30) islandImg.src = "img/island_LV30.jpeg";
      else if (level >= 20) islandImg.src = "img/island_LV20.jpeg";
      else if (level >= 10) islandImg.src = "img/island_LV10.jpeg";
      else islandImg.src = "img/island_LV01.jpeg";
    }

    function updateIslandHeight() {
      // åªæœ‰åœ¨é›»è…¦ç‰ˆï¼ˆè¢å¹•å¯¬åº¦å¤§æ–¼ 968pxï¼‰æ‰åŸ·è¡Œæ­¤é‚è¼¯
      if (window.innerWidth > 968) {
        // ç¢ºä¿ cityGrid å·²ç¶“æ¸²æŸ“å®Œæˆï¼Œæ‰èƒ½æ­£ç¢ºè¨ˆç®—é«˜åº¦
        // å¦‚æœ grid çš„ display æ˜¯ gridï¼Œå…¶ offsetHeight æœƒåŒ…å« gap
        const totalHeight = cityGrid.offsetHeight;
        
        // è¨­å®š islandContainer çš„é«˜åº¦
        islandContainer.style.height = `${totalHeight}px`;

        // èª¿æ•´ islandContainer çš„å¯¬åº¦ï¼Œè®“å…¶ç¶­æŒæ­£æ–¹å½¢ï¼Œä¸¦èˆ‡é«˜åº¦å°æ‡‰
        // é€™è£¡æˆ‘å€‘å‡è¨­åœ–ç‰‡æ˜¯æ­£æ–¹å½¢ (1024x1024)ï¼Œæ‰€ä»¥å¯¬åº¦ä¹Ÿæ‡‰è©²æ˜¯é«˜åº¦
        islandContainer.style.width = `${totalHeight}px`; 
        islandContainer.style.maxWidth = '500px'; // ä¿æŒæœ€å¤§å¯¬åº¦é™åˆ¶
      } else {
        // æ‰‹æ©Ÿç‰ˆæ¢å¾©è‡ªå‹•é«˜åº¦å’Œå¯¬åº¦ï¼Œä¸¦ä¿æŒæ­£æ–¹å½¢æ¯”ä¾‹
        islandContainer.style.height = 'auto';
        islandContainer.style.width = 'auto';
      }
    }

    function updateUI() {
      playerNameEl.textContent = playerName; // æ›´æ–°ç©å®¶åç¨±
      playerLevelEl.textContent = playerLevel;
      levelBar.style.width = (playerExp % 100) + "%"; // å‡è¨­æ¯100é»ç¶“é©—å‡ç´š
      avatarImg.src = playerAvatar; // æ›´æ–°é ­åƒ
      updateIsland(playerLevel);
      renderCities();
      // ç¢ºä¿åœ¨æ‰€æœ‰ DOM å…ƒç´ æ¸²æŸ“å®Œæˆå¾Œæ‰è¨ˆç®—é«˜åº¦
      requestAnimationFrame(updateIslandHeight); 
      saveData(); // æ›´æ–°å¾Œç«‹å³å­˜æª”
    }

    // æ¸¬è©¦å‡ç´šæŒ‰éˆ• (å·²ä¿®æ­£)
    const testBtn = document.getElementById('testLevelBtn');
    testBtn.addEventListener('click', () => {
      // æ¯æ¬¡é»æ“Šå¢åŠ 10ç´šï¼Œä¸¦å°‡ç¶“é©—æ¢è¨­ç‚º100%ï¼Œä»¥æ¨¡æ“¬ç­‰ç´šæå‡
      playerLevel = Math.min(playerLevel + 10, 30); // æ¯æ¬¡å¢åŠ 10ç´šï¼Œæœ€é«˜30ç´š
      playerExp = 100; // æ¨¡æ“¬ç¶“é©—æ¢æ»¿æ ¼

      // 20 åŸå€åŒæ­¥å‡ç´š
      cityLevels = cityLevels.map(lv => Math.min(lv + 10, 30)); // æ¯å€‹åŸå€ä¹ŸåŒæ­¥å‡ç´šï¼Œæœ€é«˜30ç´š
      updateUI();
    });

    // é‡ç½®é€²åº¦æŒ‰éˆ•
    const resetProgressBtn = document.getElementById('resetProgressBtn');
    resetProgressBtn.addEventListener('click', () => {
      if (confirm("ç¢ºå®šè¦é‡ç½®æ‰€æœ‰éŠæˆ²é€²åº¦å—ï¼Ÿé€™å°‡ç„¡æ³•å¾©åŸï¼")) {
        localStorage.removeItem("toeicIslandSave");
        location.reload(); // é‡è¼‰é é¢ä»¥å›åˆ°åˆå§‹ç‹€æ…‹
      }
    });

    // æ”¹ååŠŸèƒ½ï¼ˆé™åˆ¶æœ€å¤š 12 å­—ï¼‰
    const renameBtn = document.getElementById('renameBtn');
    renameBtn.addEventListener('click', () => {
      const maxLength = 12;
      const newName = prompt(`è«‹è¼¸å…¥æ–°åç¨±ï¼ˆæœ€å¤š ${maxLength} å­—ï¼‰ï¼š`, playerName);
      if (newName && newName.trim() !== "") {
        if (newName.trim().length > maxLength) {
          alert(`åç¨±ä¸èƒ½è¶…é ${maxLength} å€‹å­—ï¼`);
          return; // è¶…éé•·åº¦å°±ä¸æ›´æ–°
        }
        playerName = newName.trim(); // æ›´æ–°ç©å®¶åç¨±è®Šæ•¸
        updateUI(); // æ›´æ–°UIä¸¦å­˜æª”
      }
    });

    // ä¸Šå‚³é ­åƒåŠŸèƒ½
    const avatarImg = document.getElementById('avatarImg');
    const avatarUpload = document.getElementById('avatarUpload');

    avatarUpload.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        const maxSize = 2 * 1024 * 1024; // é™åˆ¶ 2MB
        if (file.size > maxSize) {
          alert("æª”æ¡ˆéå¤§ï¼Œè«‹é¸æ“‡å°æ–¼ 2MB çš„åœ–ç‰‡ï¼");
          avatarUpload.value = ""; // æ¸…ç©ºæª”æ¡ˆ
          return;
        }

        const reader = new FileReader();
        reader.onload = function(event) {
          playerAvatar = event.target.result; // å­˜é€²è®Šæ•¸
          avatarImg.src = playerAvatar;       // æ›´æ–°ç•«é¢
          saveData();                         // å­˜æª”
        };
        reader.readAsDataURL(file);
      }
    });


    // èªªæ˜è¦–çª—
    const helpBtn = document.querySelector('.help-btn');
    const helpModal = document.getElementById('helpModal');
    const closeModal = document.getElementById('closeModal');
    helpBtn.addEventListener('click', () => {
      helpModal.style.display = 'flex';
    });
    closeModal.addEventListener('click', () => {
      helpModal.style.display = 'none';
    });
    window.addEventListener('click', (e) => {
      if (e.target === helpModal) {
        helpModal.style.display = 'none';
      }
    });

    // åˆå§‹åŒ–
    loadData();
    updateUI();

    // ç›£è½è¦–çª—å¤§å°æ”¹è®Šï¼Œä»¥å³æ™‚èª¿æ•´é«˜åº¦å’Œå¯¬åº¦
    window.addEventListener('resize', updateIslandHeight);
  </script>
</body>
</html>