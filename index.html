<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>TOEIC Island</title>
  <style>
    body {
      margin: 0;
      font-family: "Microsoft JhengHei", sans-serif;
      background: #f2f7fb;
      color: #333;
      overflow-x: hidden;
    }
    header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      padding: 10px 20px;
      flex-wrap: wrap;
    }
    .player-info {
      display: flex;
      align-items: center;
      gap: 10px;
      flex: 1;
      flex-wrap: wrap;
    }
    .player-info img.avatar {
      width: 50px;
      height: 50px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid #ddd;
      cursor: pointer;
    }
    .player-name {
      font-weight: bold;
      font-size: 18px;
    }
    .rename-icon {
      width: 22px;
      height: 22px;
      cursor: pointer;
      vertical-align: middle;
    }
    .level-container {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .level {
      font-size: 14px;
    }
    .level-bar {
      width: 100px;
      height: 8px;
      background: #ddd;
      border-radius: 5px;
      overflow: hidden;
      margin-left: 5px;
      display: inline-block;
      vertical-align: middle;
    }
    .level-bar-fill {
      height: 100%;
      width: 0%; 
      background: #4caf50;
      transition: width 0.3s;
    }
    .help-btn {
      width: 32px;
      height: 32px;
      border: none;
      border-radius: 50%;
      background: #fff;
      cursor: pointer;
      font-weight: bold;
      font-size: 18px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      transition: transform 0.2s;
    }
    .help-btn:hover {
      background: #f8f8f8;
      transform: scale(1.1);
    }

    /* è³‡æºåˆ— */
    .resources {
      display: flex;
      align-items: center;
      gap: 10px;
      flex-wrap: wrap;
    }
    .resource {
      display: flex;
      align-items: center;
      gap: 5px;
      font-size: 16px;
    }
    .resource img {
      width: 24px;
      height: 24px;
    }

    main {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 10px;
    }
    .island-container {
      position: relative;
      max-width: 1024px;
      border-radius: 20px;
      overflow: hidden;
    }
    .island-container img {
      width: 100%;
      height: auto;
      display: block;
    }

    /* åŸå€çŸ©é™£ */
    .city-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 15px; /* å¢åŠ æŒ‰éˆ•é–“è· */
      margin-top: 25px; /* å¢åŠ èˆ‡å³¶åœ–çš„é–“è· */
      max-width: 1024px;
      width: 100%;
      padding: 0 10px; /* å·¦å³å…§é‚Šè·ï¼Œé¿å…è²¼é‚Š */
    }
    
    /* æ–°çš„åŸå€æŒ‰éˆ•æ¨£å¼ */
    .city-button {
      display: flex;
      flex-direction: column; /* è®“æ–‡å­—å’Œç­‰ç´šå‚ç›´æ’åˆ— */
      justify-content: center;
      align-items: center;
      height: 90px; /* å›ºå®šæŒ‰éˆ•é«˜åº¦ */
      background: linear-gradient(135deg, #a8dadc, #457b9d); /* æ¼¸è®ŠèƒŒæ™¯ */
      color: white;
      text-decoration: none;
      border-radius: 12px;
      font-weight: bold;
      font-size: 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
      transition: transform 0.2s, background 0.2s, box-shadow 0.2s;
      cursor: pointer;
      border: none; /* ç§»é™¤é è¨­æŒ‰éˆ•é‚Šæ¡† */
      padding: 5px; /* å…§éƒ¨å¡«å…… */
      text-align: center; /* æ–‡å­—ç½®ä¸­ */
      white-space: normal; /* å…è¨±æ–‡å­—æ›è¡Œ */
      overflow: hidden; /* éš±è—è¶…å‡ºéƒ¨åˆ† */
    }
    .city-button:hover {
      transform: translateY(-3px) scale(1.02);
      background: linear-gradient(135deg, #FFD700, #FFA07A); /* ğŸ”¥ æ‡¸åœæ™‚è®Šç‚ºæŸ”å’Œæš–è‰² */
      box-shadow: 0 6px 12px rgba(0,0,0,0.3);
    }
    .city-button span.city-name {
        font-size: 1.2em; /* åŸå€åç¨±ç¨å¤§ */
        line-height: 1.2;
    }
    .city-button span.city-level {
        font-size: 0.9em; /* ç­‰ç´šæ–‡å­—ç¨å° */
        margin-top: 3px;
        opacity: 0.9;
    }


    footer {
      text-align: center;
      font-size: 12px;
      color: #777;
      padding: 20px 10px; /* å¢åŠ ä¸Šä¸‹é–“è· */
    }

    /* æ¸¬è©¦æŒ‰éˆ•å®¹å™¨ */
    .action-buttons {
      display: flex;
      justify-content: center;
      gap: 15px; /* æŒ‰éˆ•é–“è· */
      margin: 10px auto 20px;
      flex-wrap: wrap; /* éŸ¿æ‡‰å¼æ›è¡Œ */
    }

    /* æ¸¬è©¦å’Œé‡ç½®æŒ‰éˆ•æ¨£å¼ */
    .action-buttons .btn {
      padding: 10px 20px;
      font-size: 16px;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      transition: background 0.2s, transform 0.2s;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      min-width: 120px; /* æœ€å°å¯¬åº¦ */
    }
    .action-buttons .btn-test {
      background: #4caf50;
      color: white;
    }
    .action-buttons .btn-test:hover {
      background: #45a049;
      transform: translateY(-2px);
    }
    .action-buttons .btn-reset {
      background: #f44336;
      color: white;
    }
    .action-buttons .btn-reset:hover {
      background: #d32f2f;
      transform: translateY(-2px);
    }


    /* éŸ¿æ‡‰å¼ï¼šæ‰‹æ©Ÿæ™‚ç¸®å°å­—é«”ï¼Œæ”¹æˆå››æ¬„ */
    @media (max-width: 768px) {
      .city-grid {
        grid-template-columns: repeat(4, 1fr); /* ğŸ”¥ æ”¹æˆå››æ¬„ */
        gap: 8px; /* èª¿æ•´æ‰‹æ©Ÿæ¿é–“è· */
      }
      .city-button {
        height: 70px; /* æ‰‹æ©Ÿç‰ˆæŒ‰éˆ•é«˜åº¦ */
        font-size: 14px; /* æ‰‹æ©Ÿç‰ˆå­—é«”ç¸®å° */
      }
      .city-button span.city-name {
        font-size: 0.9em;
      }
      .city-button span.city-level {
        font-size: 0.75em;
      }
      .action-buttons .btn {
        padding: 8px 15px;
        font-size: 14px;
        min-width: 100px;
      }
    }

    /* èªªæ˜è¦–çª— */
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.6);
      justify-content: center;
      align-items: center;
      z-index: 1000; /* ç¢ºä¿åœ¨æœ€ä¸Šå±¤ */
    }
    .modal-content {
      background: #fff;
      padding: 25px; /* å¢åŠ å…§é‚Šè· */
      border-radius: 12px;
      max-width: 500px;
      text-align: left;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      position: relative; /* ç‚ºäº†é—œé–‰æŒ‰éˆ•å®šä½ */
    }
    .modal-close {
      position: absolute; /* çµ•å°å®šä½é—œé–‰æŒ‰éˆ• */
      top: 10px;
      right: 15px;
      cursor: pointer;
      font-weight: bold;
      font-size: 24px; /* é—œé–‰æŒ‰éˆ•å­—é«”å¤§ä¸€é» */
      color: #777;
    }
    .modal-close:hover {
        color: #333;
    }
  </style>
</head>
<body>
  <header>
    <!-- å·¦å´ç©å®¶è³‡è¨Š -->
    <div class="player-info">
      <input type="file" id="avatarUpload" accept="image/*" style="display:none">
      <img src="img/avatar.png" alt="avatar" class="avatar" id="avatarImg">
      <span class="player-name" id="playerName">å³¶ä¸»</span>
      <img src="img/rename.png" class="rename-icon" alt="rename" id="renameBtn">
      <div class="level-container">
        <div class="level">LV: <span id="playerLevel">1</span>
          <div class="level-bar"><div class="level-bar-fill" id="levelBar"></div></div>
        </div>
        <button class="help-btn">?</button>
      </div>
    </div>

    <!-- å³å´è³‡æº -->
    <div class="resources">
      <div class="resource"><img src="img/item001.png"><span>0</span></div>
      <div class="resource"><img src="img/item002.png"><span>0</span></div>
      <div class="resource"><img src="img/item003.png"><span>0</span></div>
      <div class="resource"><img src="img/item004.png"><span>0</span></div>
      <div class="resource"><img src="img/item005.png"><span>0</span></div>
    </div>
  </header>

  <main>
    <div class="island-container">
      <img src="img/island_LV1.jpeg" alt="island" id="island-img">
    </div>

    <!-- 20 åŸå€çŸ©é™£ (JS ç”Ÿæˆ) -->
    <div class="city-grid" id="cityGrid"></div>
  </main>

  <!-- æ¸¬è©¦èˆ‡é‡ç½®æŒ‰éˆ•å€å¡Š -->
  <div class="action-buttons">
    <button class="btn btn-test" id="testLevelBtn">ğŸ”¼ æ¸¬è©¦å‡ç´š</button>
    <button class="btn btn-reset" id="resetProgressBtn">ğŸ”„ é‡ç½®é€²åº¦</button>
  </div>

  <footer>
    Copyright Â© 2025 Comibast All Rights Reserved
  </footer>

  <!-- èªªæ˜è¦–çª— -->
  <div class="modal" id="helpModal">
    <div class="modal-content">
      <span class="modal-close" id="closeModal">&times;</span>
      <h3>ç©æ³•èªªæ˜</h3>
      <p>
        TOEICå–®å­—ä¾ç…§é¡åˆ¥åˆ†æˆ20å€ï¼Œé»é¸åŸå€é€²è¡Œæ‹¼å­—éŠæˆ²ã€‚<br>
        æ¯æ¬¡5å€‹å–®å­—ï¼Œç­”å°ä¸€å­—20åˆ†ï¼Œæ»¿åˆ†100åˆ†ã€‚<br>
        å¯ä»¥ä½¿ç”¨æç¤ºä¸‹ä¸€å€‹å­—æ¯çš„åŠŸèƒ½ï¼Œæ¯ç”¨ä¸€æ¬¡æ‰£ä¸€åˆ†ã€‚<br>
        åˆ†æ•¸æœƒè½‰åŒ–æˆç¶“é©—å€¼ï¼Œæå‡åŸå€ç­‰ç´šã€‚<br>
        ç©å®¶ç­‰ç´šç‚ºå…¨å³¶åŸå€ç­‰ç´šçš„å¹³å‡å€¼ï¼ˆå››æ¨äº”å…¥ï¼‰ã€‚<br>
        æ¯å‡10ç´šï¼Œä¸»å³¶çš„æ¨¡æ¨£æœƒé€²åŒ–ï¼Œå¾ç°¡å–®å¯æ„›ï¼Œè®Šå¾—è¯éº—ç²¾ç·»ï¼
      </p>
    </div>
  </div>

  <script>
    // åŸå€åç¨±
    const cities = [
      "ä½å®¿äº¤é€š", "é¤é£²è§€å…‰", "è¡ŒéŠ·éŠ·å”®", "èª¿æŸ¥ç ”ç©¶", "ç¤¾æœƒè²¡ç¶“",
      "éƒ¨é–€çµ„ç¹”", "æ‹›å‹Ÿè–ªè³‡", "ç¸¾æ•ˆè¨“ç·´", "è³¼ç‰©è¨‚å–®", "å”®å¾Œæœå‹™",
      "ç¶“ç‡Ÿç®¡ç†", "ç”Ÿç”¢è£½é€ ", "è¾¦å…¬æºé€š", "è¡Œæ”¿æœƒè­°", "è¨­å‚™ç ”ç™¼",
      "é‡‘èè²¡å‹™", "æˆ¿å±‹ä¿®ç¹•", "å‚³åª’å‡ºç‰ˆ", "è—æ–‡æ´»å‹•", "å¥åº·ç”Ÿæ´»"
    ];

    // é è¨­å€¼
    let playerLevel = 1;
    let playerExp = 0; // ç©å®¶ç¶“é©—å€¼ï¼Œç”¨æ–¼é¡¯ç¤ºé€²åº¦æ¢
    let cityLevels = new Array(20).fill(1);
    let playerName = "å³¶ä¸»"; // æ–°å¢ç©å®¶åç¨±ç‹€æ…‹

    // å˜—è©¦å¾ localStorage è¼‰å…¥è³‡æ–™
    function loadData() {
      const data = localStorage.getItem("toeicIslandSave");
      if (data) {
        const save = JSON.parse(data);
        playerLevel = save.playerLevel || 1;
        playerExp = save.playerExp || 0;
        cityLevels = save.cityLevels || new Array(20).fill(1);
        playerName = save.playerName || "å³¶ä¸»"; // è¼‰å…¥ç©å®¶åç¨±
      }
    }

    // å„²å­˜è³‡æ–™åˆ° localStorage
    function saveData() {
      const save = {
        playerLevel,
        playerExp,
        cityLevels,
        playerName // å„²å­˜ç©å®¶åç¨±
      };
      localStorage.setItem("toeicIslandSave", JSON.stringify(save));
    }

    // ç”¢ç”ŸåŸå€çŸ©é™£ (æ›´æ–°ç‚ºæŒ‰éˆ•æ¨£å¼)
    function renderCities() {
      const grid = document.getElementById("cityGrid");
      grid.innerHTML = "";
      cities.forEach((name, i) => {
        const level = cityLevels[i];
        const filename = (i+1).toString().padStart(2,"0") + name + ".html";
        
        const button = document.createElement("a"); // ä½¿ç”¨aæ¨™ç±¤æ¨¡æ“¬æŒ‰éˆ•ï¼Œæ–¹ä¾¿è·³è½‰
        button.href = filename;
        button.className = "city-button";
        button.innerHTML = `
          <span class="city-name">${name}</span>
          <span class="city-level">LV${level}</span>
        `;
        grid.appendChild(button);
      });
    }

    // ç©å®¶ UI æ›´æ–°
    const playerLevelEl = document.getElementById('playerLevel');
    const levelBar = document.getElementById('levelBar');
    const islandImg = document.getElementById('island-img');
    const playerNameEl = document.getElementById('playerName'); // ç²å–ç©å®¶åç¨±å…ƒç´ 

    function updateIsland(level) {
      if (level >= 30) islandImg.src = "img/island_LV30.jpeg";
      else if (level >= 20) islandImg.src = "img/island_LV20.jpeg";
      else if (level >= 10) islandImg.src = "img/island_LV10.jpeg";
      else islandImg.src = "img/island_LV1.jpeg";
    }

    function updateUI() {
      playerNameEl.textContent = playerName; // æ›´æ–°ç©å®¶åç¨±
      playerLevelEl.textContent = playerLevel;
      levelBar.style.width = (playerExp % 100) + "%"; // å‡è¨­æ¯100é»ç¶“é©—å‡ç´š
      updateIsland(playerLevel);
      renderCities();
      saveData(); // æ›´æ–°å¾Œç«‹å³å­˜æª”
    }

    // æ¸¬è©¦å‡ç´šæŒ‰éˆ•
    const testBtn = document.getElementById('testLevelBtn');
    testBtn.addEventListener('click', () => {
      // æ¨¡æ“¬å‡ç´šé‚è¼¯ï¼šå¢åŠ ç¶“é©—å€¼ï¼Œæ¯100é»ç¶“é©—å‡ä¸€ç´š
      playerExp += 50; // æ¯æ¬¡é»æ“Šå¢åŠ 50ç¶“é©—
      if (playerExp >= playerLevel * 100) { // å‡è¨­æ¯ç´šæ‰€éœ€ç¶“é©—ç‚º playerLevel * 100
        playerLevel++;
        playerExp = playerExp % 100; // é‡ç½®ç¶“é©—æ¢
      }

      if (playerLevel > 30) playerLevel = 30; // æœ€é«˜30ç´š
      
      // 20 åŸå€åŒæ­¥å‡ç´š (ç°¡åŒ–é‚è¼¯ï¼Œå¯¦éš›æ‡‰æ ¹æ“šéŠæˆ²åˆ†æ•¸è¨ˆç®—)
      cityLevels = cityLevels.map(lv => Math.min(lv + 1, 30)); // æ¯å€‹åŸå€ä¹ŸåŒæ­¥å‡ç´šï¼Œæœ€é«˜30ç´š
      updateUI();
    });

    // é‡ç½®é€²åº¦æŒ‰éˆ•
    const resetProgressBtn = document.getElementById('resetProgressBtn');
    resetProgressBtn.addEventListener('click', () => {
      if (confirm("ç¢ºå®šè¦é‡ç½®æ‰€æœ‰éŠæˆ²é€²åº¦å—ï¼Ÿé€™å°‡ç„¡æ³•å¾©åŸï¼")) {
        localStorage.removeItem("toeicIslandSave");
        location.reload(); // é‡è¼‰é é¢ä»¥å›åˆ°åˆå§‹ç‹€æ…‹
      }
    });

    // æ”¹ååŠŸèƒ½
    const renameBtn = document.getElementById('renameBtn');
    renameBtn.addEventListener('click', () => {
      const newName = prompt("è«‹è¼¸å…¥æ–°åç¨±ï¼š", playerName); // ä½¿ç”¨ playerName è®Šæ•¸
      if (newName && newName.trim() !== "") {
        playerName = newName.trim(); // æ›´æ–°ç©å®¶åç¨±è®Šæ•¸
        updateUI(); // æ›´æ–°UIä¸¦å­˜æª”
      }
    });

    // ä¸Šå‚³é ­åƒåŠŸèƒ½
    const avatarImg = document.getElementById('avatarImg');
    const avatarUpload = document.getElementById('avatarUpload');
    avatarImg.addEventListener('click', () => {
      avatarUpload.click();
    });
    avatarUpload.addEventListener('change', (e) => {
      const file = e.target.files[0];
      if (file) {
        const reader = new FileReader();
        reader.onload = function(event) {
          avatarImg.src = event.target.result;
        };
        reader.readAsDataURL(file);
      }
    });

    // èªªæ˜è¦–çª—
    const helpBtn = document.querySelector('.help-btn');
    const helpModal = document.getElementById('helpModal');
    const closeModal = document.getElementById('closeModal');
    helpBtn.addEventListener('click', () => {
      helpModal.style.display = 'flex';
    });
    closeModal.addEventListener('click', () => {
      helpModal.style.display = 'none';
    });
    window.addEventListener('click', (e) => {
      if (e.target === helpModal) {
        helpModal.style.display = 'none';
      }
    });

    // åˆå§‹åŒ–
    loadData();
    updateUI();
  </script>
</body>
</html>